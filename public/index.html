<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>읽다</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap" rel="stylesheet" />
    <style>
      * {
        font-family: 'Nanum Myeongjo', serif;
      }
    </style>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./style_ind.css" />
    <script>
      function move2lib(_title, _authors, _thumbnail, _isbn) {
        const db = firebase.firestore()
        var sIsbn = _isbn.split(' ')
        var tIsbn = sIsbn[1]
        var dat = {
          title: _title,
          thumbnail: _thumbnail,
          authors: _authors,
          isbn: _isbn,
          isbnR: tIsbn,
          wish: true,
          createAt: firebase.firestore.FieldValue.serverTimestamp(),
        }
        db.collection('book_test')
          .doc(_isbn)
          .set(dat)
          .then(() => {
            window.location.href = '/library.html'
          })
          .catch((err) => {
            console.log(err)
          })
      }
    </script>
  </head>

  <body>
    <script src="/__/firebase/8.7.1/firebase-app.js"></script>
    <script src="/__/firebase/8.7.1/firebase-auth.js"></script>
    <script src="/__/firebase/8.7.1/firebase-firestore.js"></script>
    <script src="/__/firebase/8.7.1/firebase-storage.js"></script>

    <script>
      var firebaseConfig = {
        apiKey: 'AIzaSyAbmqKRLiQGTnwQceuUA6nU4sU7DMWG35A',
        authDomain: 'madcamp2-4c469.firebaseapp.com',
        databaseURL: 'https://madcamp2-4c469-default-rtdb.firebaseio.com',
        projectId: 'madcamp2-4c469',
        storageBucket: 'madcamp2-4c469.appspot.com',
        messagingSenderId: '496486665118',
        appId: '1:496486665118:web:6db4560115692b36da648f',
        measurementId: 'G-M2KP2XT3M7',
      }
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig)
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <input type="text" id="query" />
    <button id="search">검색</button>
    <div class="search"></div>

    <script>
      const db = firebase.firestore()
      $(document).ready(function () {
        var pageNum = 1

        $('#search').click(function () {
          $('.search').html('')

          $.ajax({
            method: 'GET',
            url: 'https://dapi.kakao.com/v3/search/book?target=title',
            data: {query: $('#query').val(), page: pageNum},
            headers: {
              Authorization: 'KakaoAK 72b502c6c7d429babec5087a1a698ff3',
            }, // ########부분에 본인의 REST API 키를 넣어주세요.
          }).done(function (msg) {
            console.log(msg)
            for (var i = 0; i < 10; i++) {
              var template = `
                <div class="srcResult" onclick='move2lib("${msg.documents[i].title}", "${msg.documents[i].authors}", "${msg.documents[i].thumbnail}", "${msg.documents[i].isbn}")'>
                  <img src='${msg.documents[i].thumbnail}'/><br>
                  <div class="indBook">
                    <h2 id='title${i}'>${msg.documents[i].title}</h2>
                    <strong>저자:</strong> ${msg.documents[i].authors}<br>
                    <strong>출판사:</strong> ${msg.documents[i].publisher}<br>
                    <strong>요약:</strong> ${msg.documents[i].contents}...<br>
                  </div>
                </div>
              `
              $('.search').append(template)
              // $('div').append('<strong>저자:</strong> ' + msg.documents[i].authors + '<br>')
              // $('div').append('<strong>출판사:</strong> ' + msg.documents[i].publisher + '<br>')
              // $('div').append('<strong>요약:</strong> ' + msg.documents[i].contents + '...<br>')
              // $('div').append("<img src='" + msg.documents[i].thumbnail + "'/><br>")
            }
          })
        })
      })
    </script>
  </body>
</html>
